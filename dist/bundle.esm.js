function t(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,f=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return f=t.done,t},e:function(t){c=!0,i=t},f:function(){try{f||null==r.return||r.return()}finally{if(c)throw i}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}var a,o=new WeakMap,i=!0;function f(){i=!1}function c(){i=!0}function u(t){a=t}function s(t,e,n){var r=o.get(t);if(r){var a=r.get(e);a&&a.forEach((function(r){if(r.__cb__Map&&r.__cb__Map.get(t)){var a=r.__cb__Map.get(t);a&&a(e,n)}else r.setData(function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},e,n))}))}}function l(t){if(!function(t){return"object"===r(t)&&null!==t}(t))throw new Error("state must be a Object!!!");return new Proxy(t,{get:function(t,e,n){return function(t,e){if(a&&i){var n=o.get(t);n||(n=new Map,o.set(t,n));var r=n.get(e);r||(r=new Set,n.set(e,r)),r.add(a)}}(t,e),Reflect.get(t,e,n)},set:function(t,e,n,r){var a=Reflect.set(t,e,n,r);return s(t,e,n),a}})}var y=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.rawState=t.state,this.actions=t.actions,this.state=l(t.state)}var r,a,i;return r=e,a=[{key:"saveEffectKeys",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.__effectKeysMap__||new Map;n.set(this.rawState,e),t.__effectKeysMap__=n}},{key:"saveCb",value:function(t,e){var n=t.__cb__Map||new Map;n.set(this.rawState,e),t.__cb__Map=n}},{key:"useData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.useKeys,a=void 0===r?[]:r,o=n.total,i=void 0!==o&&o,f=n.immediate,c=void 0===f||f,s=n.cb,l=(null==a?void 0:a.length)||0;if(i||0!==l){var y=i?Object.keys(this.state):a;u(e),s&&this.saveCb(e,s),this.saveEffectKeys(e,y);var v,b={},h=t(y);try{for(h.s();!(v=h.n()).done;){var p=v.value,_=this.state[p];!s&&c&&(b[p]=_),s&&c&&s(p,_)}}catch(t){h.e(t)}finally{h.f()}!s&&c&&e.setData(b)}}},{key:"unUseData",value:function(e){var n,r=o.get(this.rawState);if(r){var a,i=t((null===(n=e.__effectKeysMap__)||void 0===n?void 0:n.get(this.rawState))||[]);try{for(i.s();!(a=i.n()).done;){var f=a.value,c=r.get(f);if(!c)break;c.delete(e),0===c.size&&r.delete(f)}}catch(t){i.e(t)}finally{i.f()}0===r.size&&o.delete(this.rawState)}}},{key:"dispatch",value:function(t){if(this.actions){if(f(),!this.actions[t])throw new Error("找不到".concat(String(t),"对应的action"));if("function"!=typeof this.actions[t])throw new Error("".concat(String(t),"对应的value不是一个函数"));for(var e,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(e=this.actions[t]).call.apply(e,[this,this.state].concat(r)),c()}}}],a&&n(r.prototype,a),i&&n(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();export{y as default};
